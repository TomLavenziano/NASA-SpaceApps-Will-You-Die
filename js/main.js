(function($){
    var S = {
        config: {
            div_no: 1,
            sleep_time: 50,
            dot_size: 3
        },
        dimension: {
            width: 1500,
            height: 650
        },
        fly_flag: false,
        path_i: 0,
        paths: [
            [1252,263],
            [1252,263],
            [1251,264],
            [1251,264],
            [1251,265],
            [1251,265],
            [1252,266],
            [1253,266],
            [1254,266],
            [1255,265],
            [1255,265],
            [1256,265],
            [1257,264],
            [1258,264],
            [1259,263],
            [1259,262],
            [1259,261],
            [1259,260],
            [1259,258],
            [1259,258],
            [1258,257],
            [1257,256],
            [1256,254],
            [1256,254],
            [1253,253],
            [1250,252],
            [1248,252],
            [1245,250],
            [1242,249],
            [1238,248],
            [1235,247],
            [1232,246],
            [1230,245],
            [1228,245],
            [1226,244],
            [1225,243],
            [1223,243],
            [1221,242],
            [1219,242],
            [1217,241],
            [1214,240],
            [1212,239],
            [1210,239],
            [1206,237],
            [1205,237],
            [1203,236],
            [1199,235],
            [1196,234],
            [1194,233],
            [1192,232],
            [1190,232],
            [1188,231],
            [1187,231],
            [1185,230],
            [1183,229],
            [1181,229],
            [1177,228],
            [1174,226],
            [1170,225],
            [1167,224],
            [1163,223],
            [1159,222],
            [1156,221],
            [1152,219],
            [1149,218],
            [1147,218],
            [1145,217],
            [1143,217],
            [1142,216],
            [1140,216],
            [1138,215],
            [1136,215],
            [1134,214],
            [1133,213],
            [1131,213],
            [1129,212],
            [1127,212],
            [1126,211],
            [1124,211],
            [1122,210],
            [1118,209],
            [1115,208],
            [1111,207],
            [1107,206],
            [1103,206],
            [1100,206],
            [1096,205],
            [1092,205],
            [1088,205],
            [1084,205],
            [1080,205],
            [1077,204],
            [1073,204],
            [1069,204],
            [1065,204],
            [1062,203],
            [1060,203],
            [1058,203],
            [1056,202],
            [1054,202],
            [1052,202],
            [1048,201],
            [1046,201],
            [1044,201],
            [1042,200],
            [1040,200],
            [1038,200],
            [1037,200],
            [1035,199],
            [1033,199],
            [1031,199],
            [1029,199],
            [1027,198],
            [1026,198],
            [1024,198],
            [1022,197],
            [1020,197],
            [1018,197],
            [1016,197],
            [1014,197],
            [1013,196],
            [1011,196],
            [1009,196],
            [1007,196],
            [1006,196],
            [1003,195],
            [1001,195],
            [999,195],
            [997,195],
            [996,195],
            [994,194],
            [992,194],
            [990,194],
            [988,194],
            [986,194],
            [984,193],
            [982,193],
            [980,193],
            [978,193],
            [977,192],
            [975,192],
            [973,192],
            [971,192],
            [969,191],
            [968,191],
            [966,191],
            [964,191],
            [962,190],
            [960,190],
            [959,190],
            [956,190],
            [954,190],
            [953,189],
            [951,189],
            [949,189],
            [948,189],
            [946,189],
            [944,189],
            [943,189],
            [941,189],
            [939,189],
            [937,189],
            [936,189],
            [934,189],
            [932,189],
            [930,189],
            [928,189],
            [926,190],
            [925,190],
            [924,190],
            [922,190],
            [920,190],
            [918,189],
            [917,189],
            [915,189],
            [913,189],
            [911,189],
            [909,189],
            [908,189],
            [906,189],
            [904,189],
            [902,189],
            [898,189],
            [894,189],
            [891,189],
            [887,189],
            [883,189],
            [881,189],
            [879,189],
            [875,189],
            [874,189],
            [872,189],
            [870,189],
            [868,189],
            [866,189],
            [865,189],
            [863,189],
            [859,189],
            [855,189],
            [853,189],
            [851,189],
            [849,189],
            [847,190],
            [845,190],
            [843,190],
            [841,190],
            [839,190],
            [837,190],
            [835,190],
            [833,190],
            [832,190],
            [828,190],
            [825,190],
            [821,190],
            [818,190],
            [814,190],
            [812,190],
            [810,190],
            [808,190],
            [806,190],
            [804,191],
            [802,191],
            [801,191],
            [799,191],
            [797,191],
            [795,191],
            [793,191],
            [791,191],
            [789,191],
            [788,191],
            [786,191],
            [783,191],
            [782,191],
            [780,191],
            [778,192],
            [776,192],
            [774,192],
            [771,192],
            [767,193],
            [764,193],
            [760,193],
            [756,194],
            [753,194],
            [749,195],
            [747,195],
            [745,195],
            [743,195],
            [741,196],
            [740,196],
            [737,196],
            [736,196],
            [734,197],
            [731,197],
            [729,197],
            [727,197],
            [726,198],
            [724,198],
            [722,198],
            [720,198],
            [718,199],
            [716,199],
            [712,199],
            [711,200],
            [709,200],
            [704,201],
            [702,201],
            [701,201],
            [699,201],
            [697,202],
            [695,202],
            [693,202],
            [691,202],
            [689,203],
            [687,203],
            [685,203],
            [683,204],
            [681,204],
            [679,204],
            [676,205],
            [672,205],
            [670,206],
            [668,206],
            [666,206],
            [664,207],
            [661,207],
            [657,208],
            [655,208],
            [653,208],
            [651,209],
            [649,209],
            [647,209],
            [643,210],
            [639,210],
            [637,210],
            [635,211],
            [633,211],
            [629,211],
            [627,211],
            [625,211],
            [623,211],
            [621,211],
            [619,212],
            [615,212],
            [612,212],
            [607,213],
            [604,213],
            [602,213],
            [599,213],
            [597,213],
            [595,214],
            [593,214],
            [591,214],
            [589,214],
            [586,214],
            [584,214],
            [581,215],
            [579,215],
            [575,215],
            [572,216],
            [570,216],
            [568,216],
            [567,216],
            [565,216],
            [563,216],
            [561,217],
            [559,217],
            [557,217],
            [554,217],
            [552,218],
            [550,218],
            [544,218],
            [540,219],
            [538,219],
            [536,219],
            [534,219],
            [532,220],
            [530,220],
            [528,220],
            [526,220],
            [524,221],
            [522,221],
            [520,221],
            [518,221],
            [514,222],
            [510,222],
            [506,223],
            [502,223],
            [498,224],
            [496,224],
            [494,224],
            [491,225],
            [489,225],
            [487,225],
            [485,225],
            [483,226],
            [481,226],
            [479,226],
            [477,226],
            [475,227],
            [474,227],
            [471,227],
            [469,228],
            [467,228],
            [465,228],
            [463,228],
            [459,229],
            [455,229],
            [451,229],
            [447,230],
            [442,230],
            [440,230],
            [435,231],
            [433,231],
            [431,231],
            [425,233],
            [424,234],
            [421,235],
            [420,235],
            [418,236],
            [414,238],
            [412,238],
            [409,239],
            [407,240],
            [405,241],
            [401,242],
            [399,243],
            [397,244],
            [395,244],
            [393,245],
            [391,246],
            [387,247],
            [386,248],
            [384,249],
            [382,249],
            [380,250],
            [378,251],
            [376,252],
            [374,252],
            [370,254],
            [367,255],
            [366,256],
            [365,256],
            [361,257],
            [359,258],
            [358,259],
            [356,260],
            [354,260],
            [352,261],
            [350,262],
            [346,263],
            [342,265],
            [338,267],
            [335,268],
            [331,270],
            [327,271],
            [323,273],
            [322,274],
            [320,274],
            [318,275],
            [314,277],
            [315,276],
            [311,278],
            [307,280],
            [303,281],
            [299,283],
            [297,284],
            [294,285],
            [290,287],
            [289,288],
            [287,288],
            [285,289],
            [281,291],
            [278,292],
            [276,293],
            [274,294],
            [273,295],
            [271,295],
            [269,296],
            [267,297],
            [266,298],
            [264,299],
            [262,300],
            [259,301],
            [257,302],
            [255,303],
            [254,303],
            [252,304],
            [250,305],
            [248,306],
            [247,306],
            [245,307],
            [242,309],
            [238,311],
            [232,313],
            [229,315],
            [227,316],
            [225,317],
            [223,318],
            [222,318],
            [220,319],
            [218,320],
            [216,321],
            [215,322],
            [213,322],
            [210,324],
            [208,325],
            [203,327],
            [202,328],
            [200,329],
            [198,330],
            [196,331],
            [194,331],
            [191,332],
            [189,332],
            [185,333],
            [184,333],
            [182,334],
            [180,334],
            [178,334],
            [176,335],
            [175,335],
            [173,336],
            [171,336],
            [169,336],
            [167,337],
            [165,337],
            [164,337],
            [162,338],
            [160,338],
            [158,339],
            [156,339],
            [155,339],
            [151,340],
            [147,341],
            [144,342],
            [144,342],
            [142,342],
            [140,343],
            [138,343]
        ],
        color_codes: { // 1: green - 10: red
            1: '#02611b',
            2: '#2c7c16',
            3: '#75ac0d',
            4: '#bbd506',
            5: '#f2ea01',
            6: '#ffdc01',
            7: '#ffab06',
            8: '#fa660d',
            9: '#e92914',
            10: '#e10119'
        },
        data: [],
        init: function() {
            S.fly_flag = false;
            S.path_no = 0;

            //S.gotoPlane(0,0); return false;

            S.initData();
        },
        initMap: function() {
            $('#map').width(S.dimension.width);
            $('#map').height(S.dimension.height);
        },
        initPlane: function() {
            var x = S.paths[S.path_i][0];
            var y = S.paths[S.path_i][1];

            S.gotoPlane(x,y);
        },
        initData: function() {
            $.get('data.json', function(data) {
                S.data = data;
                S.initMap();
                S.initPlane();
                S.startPlane();
            });
        },
        getData: function() {
            return S.data[S.path_i];
        },
        getPlaneXY: function() {
            var position = $('#plane').position();
            return {x: position.left, y: position.top};
        },
        startPlane: function() {
            S.fly_flag = true;
            S.nextMove();
        },
        stopPlane: function() {
            S.fly_flag = false;
        },
        changIconColor: function() {
            var data = S.getData();
            $('#city').css('background-color', S.color_codes[data.city]);
            $('#eco').css('background-color', S.color_codes[data.eco]);
            $('#you').css('background-color', S.color_codes[data.you]);
        },
        gotoPlane: function(x,y) {
            $('#plane').css({left: x, top: y});
        },
        nextMove: function() {
            ++S.path_i;
            var x = S.paths[S.path_i][0];
            var y = S.paths[S.path_i][1];

            S.movePlane(x,y);
            S.changIconColor();
        },
        movePlane: function(to_x, to_y) {
            // set from & to
            var fr_xy = S.getPlaneXY();
            var fr_x = fr_xy.x;
            var fr_y = fr_xy.y;

            // how much at one step
            var inc_x = (to_x - fr_x) / S.config.div_no;
            var inc_y = (to_y - fr_y) / S.config.div_no;

            // where to start
            var curr_x = fr_x;
            var curr_y = fr_y;

            // build path
            var arr_path = [];
            for (var i = 0; i < S.config.div_no; i++) {
                curr_x += inc_x;
                curr_y += inc_y;
                arr_path.push([curr_x, curr_y]);
            }
            arr_path.push([to_x, to_y]);

            var i = 0;
            setTimeout(nextStep, S.config.sleep_time);

            // next step
            function nextStep() {
                var data = S.getData();
                var avg = Math.round((data.city + data.eco + data.you) / 3);
                S.gotoPlane(arr_path[i][0], arr_path[i][1]);
                S.drawDot(arr_path[i][0], arr_path[i][1], S.color_codes[avg]);
                if (i < arr_path.length - 1) {
                    // next step
                    i++;
                    setTimeout(nextStep, S.config.sleep_time);
                }else if (S.fly_flag) {
                    // next move
                    if (S.path_i < S.paths.length - 1) {
                        S.nextMove();
                    }else {
                        S.stopPlane();
                    }
                }
            }
        },
        drawDot: function(x,y,color) {
            var ctx = document.getElementById("canvas").getContext("2d");
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, S.config.dot_size, 0, Math.PI * 2, true);
            ctx.fill();
        }
    };

    $( document ).ready(function() {
        S.init();
    });
})(jQuery)